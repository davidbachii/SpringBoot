<!DOCTYPE html>
<html>
<head>
    <title>Chat</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
          integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css"
          href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">
    <link rel="stylesheet" th:href="@{/css/chat.css}" href="../static/css/chat.css">

    <link th:href="@{/css/style.css}" href="../static/css/style.css" rel="stylesheet">
    <!-- styles needed for carousel slider -->
    <link th:href="@{/css/multicines.css}" href="../static/css/multicines.css" rel="stylesheet">

    <link rel='stylesheet'
          href='https://themes.getbootstrap.com/wp-content/themes/bootstrap-marketplace/style.css?ver=1590611604'/>


</head>
<!--Coded With Love By Mutiullah Samim-->
<body>
<div class="header">
    <nav class="navbar fixed-top navbar-site navbar-light bg-light navbar-expand-lg" role="navigation">
        <div class="container">
            <div class="navbar-identity">

                <button data-target=".navbar-collapse" data-toggle="collapse" class="navbar-toggler pull-right"
                        type="button">
                </button>
            </div>
            <div class="navbar-collapse collapse" style="height: auto;">
                <ul class="nav navbar-nav ml-auto navbar-right">
                    <li class="nav-item"><a th:href="@{/api/peliculas/}" class="nav-link">VOLVER AL MENU PRINCIPAL</a>
                    </li>
                    <li class="nav-item"><a th:href="@{/api/users/}" class="nav-link">REGISTRARSE</a></li>
                </ul>
            </div>
        </div>
    </nav>
</div>
<div class="container-fluid h-100">

    <div class="row justify-content-center h-100">
        <div class="col-md-8 col-xl-5 chat">
            <div class="card mb-sm-3 mb-md-0 contacts_card">
                <div class="card-header">
                    <div class="input-group">
                        <input type="text" placeholder="Search..." name="" class="form-control search">
                        <div class="input-group-prepend">
                            <span class="input-group-text search_btn"><i class="fas fa-search"></i></span>
                        </div>
                    </div>
                </div>
                <div class="card-body contacts_body">
                    <ui class="contacts">
                        <li th:each="comunidad : ${comunidades}" class="active">
                            <div class="d-flex bd-highlight">
                                <div class="img_cont">
                                    <img th:src="@{'/' + ${comunidad.getUrl_image}}" class="rounded-circle user_img">
                                    <span class="online_icon"></span>
                                </div>
                                <div class="user_info">
                                    <a th:href="@{'/api/ChatCommunity/' + ${comunidad.getNombreComunidad()}}">
                                        <span th:text="${comunidad.getNombreComunidad()}"></span>
                                    </a>
                                    <p th:text="${comunidad.getDescripcion()}"></p>
                                </div>
                            </div>
                        </li>
                    </ui>
                </div>
                <div class="card-footer"></div>
            </div>
        </div>
        <div class="col-md-8 col-xl-7 chat">
            <div class="card">
                <div class="card-header msg_head">
                    <div class="d-flex bd-highlight">
                        <div class="img_cont">
                            <img th:src="@{'/' + ${comunidadSeleccionada.getUrl_image()}}"
                                 class="rounded-circle user_img">
                            <span class="online_icon"></span>
                        </div>
                        <div class="user_info">
                            <span th:text="${comunidadSeleccionada.getNombreComunidad()}"></span>
                            <p th:text="${'Fecha de Creación: ' + comunidadSeleccionada.getFechaCreacion()}"></p>
                        </div>
                    </div>
                    <span id="action_menu_btn"><i class="fas fa-ellipsis-v"></i></span>
                </div>
                <div class="card-body msg_card_body">
                    <div th:each="mensaje : ${AllMessages}"
                         th:class="${mensaje.sentBy.nickname == user.nickname} ? 'd-flex justify-content-end mb-4' : 'd-flex justify-content-start mb-4'">
                        <div th:if="${mensaje.sentBy.nickname == user.nickname}" class="msg_cotainer_send">
                            <span class="username-send" th:text="${mensaje.sentBy.nickname}"></span><br>
                            <span th:text="${mensaje.getMessage()}"></span>
                            <span class="msg_time_send" th:text="${mensaje.getHoraEnvio() + ' ' }"></span>
                        </div>
                        <div th:if="${mensaje.sentBy.nickname == user.nickname}" class="img_cont_msg">

                            <img th:src="@{${user.getUrl_image_perfil()}}" class="rounded-circle user_img_msg">
                        </div>
                        <div th:unless="${mensaje.sentBy.nickname == user.nickname}" class="img_cont_msg">
                            <img th:src="@{${mensaje.sentBy.getUrl_image_perfil()}}"
                                 class="rounded-circle user_img_msg">
                        </div>
                        <div th:unless="${mensaje.sentBy.nickname == user.nickname}" class="msg_cotainer">
                            <span class="username" th:text="${mensaje.sentBy.nickname}"></span><br>
                            <span th:text="${mensaje.getMessage()}"></span>
                            <span class="msg_time" th:text="${mensaje.getHoraEnvio() + ' ' }"></span>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <div th:if="${user.getPlanSuscripcion() != 'Gratis'}">
                        <form th:action="@{/api/ChatCommunity/sendMessage}" method="post">
                            <div class="input-group">
                                <div class="input-group-append">
                                    <span class="input-group-text attach_btn"><i class="fas fa-paperclip"></i></span>
                                </div>
                                <textarea name="content" class="form-control type_msg"
                                          placeholder="Type your message..."
                                          required></textarea>
                                <input type="hidden" name="communityName"
                                       th:value="${comunidadSeleccionada.nombreComunidad}"/>
                                <div class="input-group-append">
                                    <button type="submit" class="input-group-text send_btn"><i
                                            class="fas fa-location-arrow"></i></button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mensaje de éxito -->
    <div th:if="${successMessage}" class="alert alert-success wc_notice" th:text="${successMessage}"></div>
    <!-- Mensaje de error -->
    <div th:if="${errorMessage}" class="alert alert-danger wc_notice" th:text="${errorMessage}"></div>


    <div th:if="${#lists.contains(roles, 'ADMIN')}" class="container mt-5">
        <!-- Contenido visible solo para administradores -->
        <div class="card" style="height: 50%;">
            <div class="card-header">
                <h3 class="titulo-cine">PANEL DE ADMINISTRADOR - CREAR COMUNIDAD</h3>
            </div>
            <div class="card-body">
                <form th:action="@{/api/ChatCommunity/create}" method="post" class="row g-3">
                    <div class="col-md-6 mb-3">
                        <label for="nombreComunidad" class="form-label">Nombre de la comunidad:</label>
                        <input type="text" id="nombreComunidad" name="nombreComunidad" required class="form-control">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="descripcionComunidad" class="form-label">Descripción:</label>
                        <input type="text" id="descripcionComunidad" name="descripcionComunidad" required
                               class="form-control">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="url_imageComunidad" class="form-label">URL de la imagen:</label>
                        <input type="text" id="url_imageComunidad" name="url_imageComunidad" required
                               class="form-control">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="fechaCreacion" class="form-label">Fecha de creación:</label>
                        <input type="date" id="fechaCreacion" name="fechaCreacion" required class="form-control">
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary">Crear Comunidad</button>
                    </div>
                </form>
            </div>
        </div>
        <br><br>


        <div class="card" style="height: 50%;">
            <div class="card-header">
                <h3 class="titulo-cine">PANEL DE ADMINISTRADOR - ACTUALIZAR COMUNIDAD</h3>
            </div>
            <div class="card-body">
                <form th:action="@{'/api/ChatCommunity/update/' + ${comunidadSeleccionada.nombreComunidad}}"
                      method="post"
                      class="row g-3">
                    <div class="col-md-6 mb-3">
                        <label for="nombreComunidadUpdate" class="form-label">Nombre de la comunidad:</label>
                        <input type="text" id="nombreComunidadUpdate" name="nombreComunidadUpdate"
                               th:value="${comunidadSeleccionada.nombreComunidad}"
                               required class="form-control">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="descripcionComunidadUpdate" class="form-label">Descripción:</label>
                        <input type="text" id="descripcionComunidadUpdate" name="descripcionComunidadUpdate"
                               th:value="${comunidadSeleccionada.descripcion}"
                               required class="form-control">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="url_imageComunidadUpdate" class="form-label">URL de la imagen:</label>
                        <input type="text" id="url_imageComunidadUpdate" name="url_imageComunidadUpdate"
                               th:value="${comunidadSeleccionada.url_image}"
                               required class="form-control">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="fechaCreacionUpdate" class="form-label">Fecha de creación:</label>
                        <input type="date" id="fechaCreacionUpdate" name="fechaCreacionUpdate"
                               th:value="${comunidadSeleccionada.fechaCreacion}"
                               required class="form-control">
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary">Actualizar Comunidad</button>
                    </div>
                </form>
            </div>
        </div>
        <br><br>
        <div class="card" style="height: 50%;">
            <div class="card-header">
                <h3 class="titulo-cine">PANEL DE ADMINISTRADOR - BORRAR COMUNIDAD</h3>
            </div>
            <div class="card-body">
                <form th:action="@{'/api/ChatCommunity/delete/' + ${comunidadSeleccionada.nombreComunidad}}"
                      method="post"
                      class="row g-3">
                    <div class="col-md-6 mb-3">
                        <label for="password" class="form-label">Contraseña:</label>
                        <input type="password" id="password" name="password" required class="form-control">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="confirmPassword" class="form-label">Confirmar Contraseña:</label>
                        <input type="password" id="confirmPassword" name="confirmPassword" required
                               class="form-control">
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-danger">Borrar Comunidad</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <br><br>

</div>
</body>
</html>
